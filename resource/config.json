{
  "frame_buffer_num": 2,
  "primarybuffer_width": 1920,
  "primarybuffer_height": 1080,
  "primarybuffer_format": "R8G8B8A8_UNORM",
  "window": {
    "title": "integration test",
    "width": 1920,
    "height" : 1080
  },
  "command_queue": [
    {
      "name": "queue_graphics",
      "type": "3d",
      "priority": "normal",
      "command_list_num": 1
    },
    {
      "name": "queue_compute",
      "type": "compute",
      "priority": "normal",
      "command_list_num": 1
    },
    {
      "name": "queue_copy",
      "type": "copy",
      "priority": "normal",
      "command_list_num": 1
    }
  ],
  "swapchain": {
    "command_queue": "queue_graphics",
    "format": "R8G8B8A8_UNORM",
    "usage": ["RENDER_TARGET_OUTPUT"]
  },
  "buffer": [
    {
      "name": "uav",
      "format": "R8G8B8A8_UNORM",
      "heap_type": "default",
      "dimension": "texture2d",
      "size_type": "swapchain_relative",
      "width": 1.0,
      "height": 1.0,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "unknown",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "uav"
    },
    {
      "name": "pingpong",
      "pingpong": true,
      "format": "R8G8B8A8_UNORM",
      "heap_type": "default",
      "dimension": "texture2d",
      "size_type": "primary_relative",
      "width": 1.0,
      "height": 1.0,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "unknown",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "rtv"
    },
    {
      "name": "cbv-a",
      "need_name_cache": true,
      "format": "UNKNOWN",
      "heap_type": "upload",
      "dimension": "buffer",
      "size_type": "absolute",
      "width": 256,
      "height": 1,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "row_major",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "common"
    },
    {
      "name": "cbv-b",
      "need_name_cache": true,
      "format": "UNKNOWN",
      "heap_type": "upload",
      "dimension": "buffer",
      "size_type": "absolute",
      "width": 256,
      "height": 1,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "row_major",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "common"
    },
    {
      "name": "cbv-c",
      "need_name_cache": true,
      "format": "UNKNOWN",
      "heap_type": "upload",
      "dimension": "buffer",
      "size_type": "absolute",
      "width": 256,
      "height": 1,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "row_major",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "common"
    },
    {
      "name": "cbv-selectedbuffer",
      "need_name_cache": true,
      "format": "UNKNOWN",
      "heap_type": "upload",
      "dimension": "buffer",
      "size_type": "absolute",
      "width": 256,
      "height": 1,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "row_major",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "common"
    },
    {
      "name": "dsv",
      "format": "D24_UNORM_S8_UINT",
      "heap_type": "default",
      "dimension": "texture2d",
      "size_type": "primary_relative",
      "width": 1.0,
      "height": 1.0,
      "depth_or_array_size": 1,
      "miplevels": 1,
      "sample_count": 1,
      "sample_quality": 0,
      "layout": "unknown",
      "mip_width": 0,
      "mip_height": 0,
      "mip_depth": 0,
      "initial_state": "dsv_write",
      "clear_depth": 1,
      "clear_stencil": 0
    },
    {
      "name": "swapchain",
      "need_name_cache": true,
      "descriptor_only": true
    },
    {
      "name": "imgui_font",
      "need_name_cache": true,
      "descriptor_only": true
    }
  ],
  "sampler": [
    {
      "name": "bilinear",
      "filter_min": "linear",
      "filter_mag": "linear",
      "filter_mip": "point",
      "address_mode": ["clamp", "clamp"],
      "mip_lod_bias": 0,
      "max_anisotropy": 0,
      "comparison_func": "never",
      "min_lod": 0,
      "max_lod": 65535
    },
    {
      "name": "trilinear",
      "filter_min": "linear",
      "filter_mag": "linear",
      "filter_mip": "linear",
      "address_mode": ["clamp", "clamp", "clamp"],
      "mip_lod_bias": 0,
      "max_anisotropy": 0,
      "comparison_func": "never",
      "border_color": [0,0,0,0],
      "min_lod": 0,
      "max_lod": 65535
    }
  ],
  "gpu_handle_num_view": 16,
  "gpu_handle_num_sampler": 8,
  "material": {
    "compile_default": {
      "target_ps": "ps_6_6",
      "target_vs": "vs_6_6",
      "target_gs": "gs_6_6",
      "target_hs": "hs_6_6",
      "target_ds": "ds_6_6",
      "target_cs": "cs_6_6",
      "target_lib": "lib_6_6",
      "target_ms": "ms_6_6",
      "target_as": "as_6_6"
    },
    "compile_unit": [
      {
        "name": "compile unit dispatch cs",
        "filename": "shader/test/dispatch.cs.hlsl",
        "target": "cs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      },
      {
        "name": "compile unit output to swapchain vs",
        "filename": "shader/test/output_to_swapchain.vs.ps.hlsl",
        "target": "vs",
        "entry": "MainVs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      },
      {
        "name": "compile unit output to swapchain ps",
        "filename": "shader/test/output_to_swapchain.vs.ps.hlsl",
        "target": "ps",
        "entry": "MainPs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      },
      {
        "name": "compile unit pingpong-a ps",
        "filename": "shader/test/pingong_a.ps.hlsl",
        "target": "ps",
        "entry": "MainPs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      },
      {
        "name": "compile unit pingpong-bc ps",
        "filename": "shader/test/pingong_bc.ps.hlsl",
        "target": "ps",
        "entry": "MainPs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      },
      {
        "name": "compile unit prez",
        "filename": "shader/test/prez.vs.hlsl",
        "target": "vs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      },
      {
        "name": "compile unit render selected buffer",
        "filename": "shader/test/render_selected_buffer.ps.hlsl",
        "target": "ps",
        "entry": "MainPs",
        "args": ["-Zi", "-Zpr", "-Qstrip_debug", "-Qstrip_reflect", "-Qstrip_rootsignature"]
      }
    ],
    "rootsig": [
      {
        "name": "rootsig dispatch cs",
        "unit_name": "compile unit dispatch cs"
      },
      {
        "name": "rootsig output to swapchain",
        "unit_name": "compile unit output to swapchain ps"
      },
      {
        "name": "rootsig pingpong-a",
        "unit_name": "compile unit pingpong-a ps"
      },
      {
        "name": "rootsig pingpong-bc",
        "unit_name": "compile unit pingpong-bc ps"
      },
      {
        "name": "rootsig prez",
        "unit_name": "compile unit prez"
      },
      {
        "name": "rootsig render selected buffer",
        "unit_name": "compile unit render selected buffer"
      }
    ],
    "pso": [
      {
        "name": "pso dispatch cs",
        "rootsig": "rootsig dispatch cs",
        "unit_list": ["compile unit dispatch cs"]
      },
      {
        "name": "pso output to swapchain",
        "rootsig": "rootsig output to swapchain",
        "unit_list": ["compile unit output to swapchain vs", "compile unit output to swapchain ps"],
        "render_target_formats": ["R8G8B8A8_UNORM"],
        "depth_stencil": {
          "depth_enable": false
        }
      },
      {
        "name": "pso pingpong-a",
        "rootsig": "rootsig pingpong-a",
        "unit_list": ["compile unit output to swapchain vs", "compile unit pingpong-a ps"],
        "render_target_formats": ["R8G8B8A8_UNORM"],
        "depth_stencil": {
          "depth_enable": false
        }
      },
      {
        "name": "pso pingpong-bc",
        "rootsig": "rootsig pingpong-bc",
        "unit_list": ["compile unit output to swapchain vs", "compile unit pingpong-bc ps"],
        "render_target_formats": ["R8G8B8A8_UNORM"],
        "depth_stencil": {
          "depth_enable": false
        }
      },
      {
        "name": "pso prez",
        "rootsig": "rootsig prez",
        "unit_list": ["compile unit prez"],
        "input_element": [
          {
            "name": "POSITION",
            "index": 0,
            "format": "R32G32B32_FLOAT",
            "slot": 0,
            "aligned_byte_offset": "APPEND_ALIGNED_ELEMENT",
            "slot_class": "PER_VERTEX_DATA",
            "instance_data_step_rate": 0
          }
        ],
        "depth_stencil": {
          "format": "D24_UNORM_S8_UINT"
        }
      },
      {
        "name": "pso render selected buffer",
        "rootsig": "rootsig render selected buffer",
        "unit_list": ["compile unit output to swapchain vs", "compile unit render selected buffer"],
        "render_target_formats": ["R8G8B8A8_UNORM"],
        "depth_stencil": {
          "depth_enable": false
        }
      }
    ]
  },
  "render_pass": [
    {
      "name": "copy resource",
      "enabled": true,
      "command_queue": "queue_copy",
      "execute": true
    },
    {
      "name": "dispatch cs",
      "enabled": true,
      "command_queue": "queue_compute",
      "wait_pass": ["output to swapchain", "debug buffer"],
      "execute": true,
      "buffer_list": [
        {
          "name": "uav",
          "state": "uav"
        }
      ],
      "material": ["pso dispatch cs"],
      "pass_vars": {
        "thread_group_count_x": 32,
        "thread_group_count_y": 32
      }
    },
    {
      "name": "prez",
      "enabled": true,
      "command_queue": "queue_graphics",
      "wait_pass": ["copy resource"],
      "execute": true,
      "buffer_list": [
        {
          "name": "dsv",
          "state": "dsv_write"
        }
      ],
      "material": ["pso prez"],
      "pass_vars": {
        "stencil_val": 255
      }
    },
    {
      "name": "pingpong-a",
      "enabled": true,
      "command_queue": "queue_graphics",
      "buffer_list": [
        {
          "name": "cbv-a",
          "state": "cbv"
        },
        {
          "name": "pingpong",
          "state": "rtv"
        }
      ],
      "flip_pingpong": ["pingpong"],
      "postpass_barrier": [
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        }
      ],
      "material": ["pso pingpong-a"],
      "pass_vars": {
        "rtv_index": 1,
        "use_sampler": false,
        "cbv": "cbv-a"
      }
    },
    {
      "name": "pingpong-b",
      "enabled": true,
      "command_queue": "queue_graphics",
      "buffer_list": [
        {
          "name": "cbv-b",
          "state": "cbv"
        },
        {
          "name": "pingpong",
          "state": "srv_ps"
        },
        {
          "name": "pingpong",
          "state": "rtv"
        }
      ],
      "sampler": ["bilinear"],
      "flip_pingpong": ["pingpong"],
      "postpass_barrier": [
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        },
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["rtv"]
        }
      ],
      "material": ["pso pingpong-bc"],
      "pass_vars": {
        "rtv_index": 2,
        "cbv": "cbv-b"
      }
    },
    {
      "name": "pingpong-c",
      "enabled": true,
      "command_queue": "queue_graphics",
      "buffer_list": [
        {
          "name": "cbv-c",
          "state": "cbv"
        },
        {
          "name": "pingpong",
          "state": "srv_ps"
        },
        {
          "name": "pingpong",
          "state": "rtv"
        }
      ],
      "sampler": ["bilinear"],
      "flip_pingpong": ["pingpong"],
      "postpass_barrier": [
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        },
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["rtv"]
        }
      ],
      "material": ["pso pingpong-bc"],
      "pass_vars": {
        "rtv_index": 2,
        "cbv": "cbv-c"
      }
    },
    {
      "name": "output to swapchain",
      "enabled": true,
      "command_queue": "queue_graphics",
      "wait_pass": ["dispatch cs"],
      "execute": true,
      "buffer_list": [
        {
          "name": "uav",
          "state": "srv_ps"
        },
        {
          "name": "dsv",
          "state": "srv_ps"
        },
        {
          "name": "swapchain",
          "state": "rtv"
        },
        {
          "name": "pingpong",
          "state": "srv_ps"
        }
      ],
      "sampler": ["bilinear"],
      "flip_pingpong": ["pingpong"],
      "prepass_barrier": [
        {
          "buffer_name": "swapchain",
          "type": "transition",
          "split_type": "none",
          "state_before": ["present"],
          "state_after": ["rtv"]
        },
        {
          "buffer_name": "uav",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        },
        {
          "buffer_name": "dsv",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        }
      ],
      "postpass_barrier": [
        {
          "buffer_name": "uav",
          "type": "transition",
          "split_type": "none",
          "state_after": ["uav"]
        },
        {
          "buffer_name": "dsv",
          "type": "transition",
          "split_type": "none",
          "state_after": ["dsv_write"]
        },
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["rtv"]
        }
      ],
      "material": ["pso output to swapchain"],
      "pass_vars": {
        "size_type": "swapchain_relative",
        "rtv_index": 2,
        "use_views": true,
        "use_sampler": true
      }
    },
    {
      "name": "debug buffer",
      "enabled": false,
      "command_queue": "queue_graphics",
      "wait_pass": ["dispatch cs"],
      "execute": true,
      "buffer_list": [
        {
          "name": "swapchain",
          "state": "rtv"
        },
        {
          "name": "cbv-selectedbuffer",
          "state": "cbv"
        },
        {
          "name": "uav",
          "state": "srv_ps"
        },
        {
          "name": "dsv",
          "state": "srv_ps"
        },
        {
          "name": "pingpong",
          "state": "srv_ps"
        }
      ],
      "sampler": ["bilinear"],
      "flip_pingpong": ["pingpong"],
      "prepass_barrier": [
        {
          "buffer_name": "swapchain",
          "type": "transition",
          "split_type": "none",
          "state_before": ["present"],
          "state_after": ["rtv"]
        },
        {
          "buffer_name": "uav",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        },
        {
          "buffer_name": "dsv",
          "type": "transition",
          "split_type": "none",
          "state_after": ["srv_ps"]
        }
      ],
      "postpass_barrier": [
        {
          "buffer_name": "uav",
          "type": "transition",
          "split_type": "none",
          "state_after": ["uav"]
        },
        {
          "buffer_name": "dsv",
          "type": "transition",
          "split_type": "none",
          "state_after": ["dsv_write"]
        },
        {
          "buffer_name": "pingpong",
          "type": "transition",
          "split_type": "none",
          "state_after": ["rtv"]
        }
      ],
      "material": ["pso render selected buffer"],
      "pass_vars": {
        "size_type": "swapchain_relative",
        "rtv_index": 0,
        "use_views": true,
        "use_sampler": true
      }
    },
    {
      "name": "imgui",
      "enabled": true,
      "command_queue": "queue_graphics",
      "execute": true,
      "buffer_list": [
        {
          "name": "imgui_font",
          "state": "srv_ps"
        },
        {
          "name": "swapchain",
          "state": "rtv"
        }
      ],
      "postpass_barrier": [
        {
          "buffer_name": "swapchain",
          "type": "transition",
          "split_type": "none",
          "state_after": ["present"]
        }
      ]
    }
  ]
}
